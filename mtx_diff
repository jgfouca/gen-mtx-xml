#! /usr/bin/env python3

import math, copy

def pprint(mtx):
    for row in mtx:
        for item in row:
            print("{:.5f}".format(item), end=" ")

        print()

def str_to_mtx(mtx_s):
    lines = mtx_s.splitlines()
    mtx = []
    for line in lines:
        if line.strip() != "":
            row = [float(item) for item in line.split()]
            mtx.append(row)

    return mtx

def mtx_diff(name, mtx1_s, mtx2_s, print_mtx=False):
    print(f"Checking {name}")
    mtx1, mtx2 = str_to_mtx(mtx1_s), str_to_mtx(mtx2_s)
    assert len(mtx1) == len(mtx2)
    if print_mtx:
        pprint(mtx1)
        print()
        pprint(mtx2)

    for row1, row2 in zip(mtx1, mtx2):
        for item1, item2 in zip(row1, row2):
            if not math.isclose(item1, item2, abs_tol=1e-5):
                print("  {:.5f} != {:.5f}".format(item1, item2))

L_exact_str = \
"""
1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.50000 0.00000 -0.01250 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.40000 0.00000 -0.01000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.27273 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.58333 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.46154 0.32418 0.01442 0.00017 1.00000 0.00000
0.00000 0.00000 0.00000 0.15385 0.16758 0.00576 0.00007 0.00000 1.00000
"""

U_exact_str = \
"""
10.00000 0.00000 0.30000 0.00000 0.00000 0.60000 0.00000 0.00000 0.00000
0.00000 11.00000 0.00000 0.00000 0.00000 0.00000 0.70000 0.00000 0.00000
0.00000 0.00000 12.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 13.00000 1.00000 -0.30000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 14.00000 -0.24000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 15.00000 -0.19091 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 16.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 17.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 18.00000
"""

L_iluk_str = \
"""
1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.50000 0.00000 -0.01250 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.40000 0.00000 -0.01000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.27273 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.58333 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.46154 0.32418 0.01442 0.00000 1.00000 0.00000
0.00000 0.00000 0.00000 0.15385 0.16758 0.00576 0.00000 0.00000 1.00000
"""

U_iluk_str = \
"""
10.00000 0.00000 0.30000 0.00000 0.00000 0.60000 0.00000 0.00000 0.00000
0.00000 11.00000 0.00000 0.00000 0.00000 0.00000 0.70000 0.00000 0.00000
0.00000 0.00000 12.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 13.00000 1.00000 -0.30000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 14.00000 -0.24000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 15.00000 -0.19091 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 16.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 17.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 18.00000
"""

L_biluk_str = \
"""
1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.50000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.40000 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.27273 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.58333 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.46154 0.35714 0.00000 0.00000 1.00000 0.00000
0.00000 0.00000 0.00000 0.15385 0.17857 0.00000 0.00000 0.00000 1.00000
"""

U_biluk_str = \
"""
10.00000 0.00000 0.30000 0.00000 0.00000 0.60000 0.00000 0.00000 0.00000
0.00000 11.00000 0.00000 0.00000 0.00000 0.00000 0.70000 0.00000 0.00000
0.00000 0.00000 12.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 13.00000 1.00000 -0.30000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 14.00000 -0.24000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 15.00000 -0.19091 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 16.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 17.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 18.00000
"""

L_biluk_lower_str = \
"""
1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.50000 0.00000 -0.01250 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.40000 0.00000 -0.01000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.27273 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.58333 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.46154 0.32418 0.01442 0.00000 1.00000 0.00000
0.00000 0.00000 0.00000 0.15385 0.16758 0.00576 0.00000 0.00000 1.00000
"""

U_biluk_lower_str = \
"""
10.00000 0.00000 0.30000 0.00000 0.00000 0.60000 0.00000 0.00000 0.00000
0.00000 11.00000 0.00000 0.00000 0.00000 0.00000 0.70000 0.00000 0.00000
0.00000 0.00000 12.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 13.00000 1.00000 -0.30000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 14.00000 -0.24000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 15.00000 -0.19091 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 16.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00275 17.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00110 0.00000 18.00000
"""

L_luc_str = \
"""
1 0 0 0 0 0 0 0 0
0 1 0 0 0 0 0 0 0
0 0 1 0 0 0 0 0 0
.5 0 -0.0125 1 0 0 0 0 0
.4 0 -0.01 0 1 0 0 0 0
0 0.27272727 0 0 0 1 0 0 0
0 0 0.5833333 0 0 0 1 0 0
0 0 0 0.46153846 0.32417582 0.01441758 0 1 0
0 0 0 0.15384615 0.16758242 0.00575824 0 0 1
"""

U_luc_str = \
"""
10 0 0.3 0 0 0.6 0 0 0
0 11 0 0 0 0 0.7 0 0
0 0 12 0 0 0 0 0 0
0 0 0 13 1 -0.3 0 0 0
0 0 0 0 14 -0.24 0 0 0
0 0 0 0 0 15 0 0 0
0 0 0 0 0 0 16 0 0
0 0 0 0 0 0 0 17 0
0 0 0 0 0 0 0 0 18
"""

L_scipy_bsr_ff2 = \
"""
1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.50000 0.00000 -0.01250 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.40000 0.00000 -0.01000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.27273 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.58333 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.46154 0.32418 0.01442 0.00017 1.00000 0.00000
0.00000 0.00000 0.00000 0.15385 0.16758 0.00576 0.00007 0.00000 1.00000
"""

U_scipy_bsr_ff2 = \
"""
10.00000 0.00000 0.30000 0.00000 0.00000 0.60000 0.00000 0.00000 0.00000
0.00000 11.00000 0.00000 0.00000 0.00000 0.00000 0.70000 0.00000 0.00000
0.00000 0.00000 12.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 13.00000 1.00000 -0.30000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 14.00000 -0.24000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 15.00000 -0.19091 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 16.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 17.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 18.00000
"""

L_bsr_exact = \
"""
1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.50000 0.00000 -0.01250 1.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.40000 0.00000 -0.01000 0.00000 1.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.27273 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.58333 0.00000 0.00000 0.00000 1.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.46154 0.32418 0.01442 0.00017 1.00000 0.00000
0.00000 0.00000 0.00000 0.15385 0.16758 0.00576 0.00007 0.00000 1.00000
"""

U_bsr_exact = \
"""
10.00000 0.00000 0.30000 0.00000 0.00000 0.60000 0.00000 0.00000 0.00000
0.00000 11.00000 0.00000 0.00000 0.00000 0.00000 0.70000 0.00000 0.00000
0.00000 0.00000 12.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 13.00000 1.00000 -0.30000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 14.00000 -0.24000 0.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 15.00000 -0.19091 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 16.00000 0.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 17.00000 0.00000
0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 18.00000
"""

mtx_diff("L exact vs iluk", L_exact_str, L_iluk_str)
mtx_diff("U exact vs iluk", U_exact_str, U_iluk_str)

mtx_diff("L exact vs scipy bsr exact", L_exact_str, L_bsr_exact)
mtx_diff("U exact vs scipy bsr exact", U_exact_str, U_bsr_exact)

mtx_diff("L scipy bsr exact vs scipy ilu", L_bsr_exact, L_scipy_bsr_ff2)
mtx_diff("U scipy bsr exact vs scipy ilu", U_bsr_exact, U_scipy_bsr_ff2)

mtx_diff("L exact vs luc", L_exact_str, L_luc_str)
mtx_diff("U exact vs luc", U_exact_str, U_luc_str)

mtx_diff("L luc vs biluk", L_luc_str, L_biluk_str)
mtx_diff("U luc vs biluk", U_luc_str, U_biluk_str)

mtx_diff("L exact vs biluk_lower", L_exact_str, L_biluk_lower_str)
mtx_diff("U exact vs biluk_lower", U_exact_str, U_biluk_lower_str)
